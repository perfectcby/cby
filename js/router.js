function PageRouter(){this.currentPage="main",this.pages={main:document.getElementById("mainPanel"),hmiResult:document.getElementById("hmiResultPage"),plcResult:document.getElementById("plcResultPage"),servoResult:document.getElementById("servoResultPage"),inverterResult:document.getElementById("inverterResultPage"),ioResult:document.getElementById("ioResultPage"),bom:document.getElementById("bomPage"),compare:document.getElementById("comparePage")},this.modals={hmi:document.getElementById("hmiFilterModal"),plc:document.getElementById("plcFilterModal"),servo:document.getElementById("servoFilterModal"),inverter:document.getElementById("inverterFilterModal"),io:document.getElementById("ioFilterModal")},this.init()}function navigateToPage(e){window.pageRouter&&window.pageRouter.showPage(e)}function openModal(e){window.pageRouter&&window.pageRouter.openFilterModal(e)}function closeModal(e){window.pageRouter&&window.pageRouter.closeFilterModal(e)}PageRouter.prototype.init=function(){this.validatePages(),this.hideAllPages(),this.showPage("main"),this.bindCoreEvents(),"loading"===document.readyState?((e=this).domReadyListener=function(){e.bindEvents()},document.addEventListener("DOMContentLoaded",this.domReadyListener)):this.bindEvents();var e=this;this.beforeUnloadListener=function(){e.cleanupResources()},window.addEventListener("beforeunload",this.beforeUnloadListener)},PageRouter.prototype.validatePages=function(){Object.keys(this.pages).forEach(function(e){this.pages[e]},this),Object.keys(this.modals).forEach(function(e){this.modals[e]},this)},PageRouter.prototype.cleanupResources=function(){this.domReadyListener&&(document.removeEventListener("DOMContentLoaded",this.domReadyListener),this.domReadyListener=null),this.coreKeydownListener&&(document.removeEventListener("keydown",this.coreKeydownListener),this.coreKeydownListener=null),this.beforeUnloadListener&&(window.removeEventListener("beforeunload",this.beforeUnloadListener),this.beforeUnloadListener=null)},PageRouter.prototype.bindCoreEvents=function(){var o=this;this.coreKeydownListener=function(e){"Escape"!==e.key&&27!==e.keyCode||Object.keys(o.modals).forEach(function(e){var t=o.modals[e];t&&t.classList.contains("show")&&o.closeFilterModal(e)})},document.addEventListener("keydown",this.coreKeydownListener)},PageRouter.prototype.bindEvents=function(){var n=this;document.querySelectorAll(".product-card").forEach(function(e){e.addEventListener("click",function(e){var t=this.getAttribute("data-type");n.openFilterModal(t)})}),document.querySelectorAll(".product-link").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();e=this.getAttribute("data-type");n.openFilterModal(e)})}),Object.keys(this.modals).forEach(function(t){var e,o=n.modals[t];o&&((e=o.querySelector(".close-"+t.toLowerCase()))&&e.addEventListener("click",function(){n.closeFilterModal(t)}),o.addEventListener("click",function(e){e.target===this&&n.closeFilterModal(t)}))});document.querySelectorAll(".back-to-main").forEach(function(e){e.addEventListener("click",function(){n.showPage("main")})});var e=document.getElementById("bomNav"),e=(e&&e.addEventListener("click",function(e){e.preventDefault(),n.showPage("bom")}),document.getElementById("compareNav"));e&&e.addEventListener("click",function(e){e.preventDefault(),n.showPage("compare")}),this.bindFilterConfirmEvents()},PageRouter.prototype.bindFilterConfirmEvents=function(){var o=this;Object.keys(this.modals).forEach(function(e){var t=o.modals[e];t&&(t=t.querySelector(".confirm-filter, .confirm-filter-btn"))&&t.addEventListener("click",function(){o.confirmFilter(e)})})},PageRouter.prototype.hideAllPages=function(){Object.values(this.pages).forEach(function(e){e&&(e.style.display="none")});var e=document.getElementById("resultsContainer");e&&e.classList.remove("show"),Object.keys(this.modals).forEach(function(e){e=this.modals[e];e&&e.classList.remove("show")},this),document.body.style.overflow="auto"},PageRouter.prototype.showPage=function(e){if(this.pages[e]||"main"===e){var t,o;this.hideAllPages(),"main"===e?(this.pages.main&&(this.pages.main.style.display="block"),window.setTopBarBackVisible&&window.setTopBarBackVisible(!1),window.setTopBarTitle&&window.setTopBarTitle("智能产品选型系统")):((t=document.getElementById("resultsContainer"))&&t.classList.add("show"),this.pages[e]&&(this.pages[e].style.display="block"),window.setTopBarBackVisible&&window.setTopBarBackVisible(!0)),this.currentPage=e,this.updateSidebarActive(e);try{"function"==typeof CustomEvent?o=new CustomEvent("pageChange",{detail:{page:e}}):(o=document.createEvent("CustomEvent")).initCustomEvent("pageChange",!0,!0,{page:e}),document.dispatchEvent(o)}catch(e){}}},PageRouter.prototype.updateSidebarActive=function(e){try{for(var t,o,n,i,a,r=document.querySelectorAll(".nav-item"),s=0;s<r.length;s++)r[s].classList.remove("active");"main"===e?(t=document.querySelector('.nav-item[data-page="main"]')||document.querySelector(".nav-item"))&&t.classList.add("active"):"bom"===e?(o=document.getElementById("bomNav"))&&o.classList.add("active"):"compare"===e?(n=document.getElementById("compareNav"))&&n.classList.add("active"):(i={hmiResult:"HMI",plcResult:"PLC",servoResult:"Servo",inverterResult:"Inverter",ioResult:"IO"}[e])&&(a=document.querySelector('.product-link[data-type="'+i+'"]'))&&a.classList.add("active")}catch(e){}},PageRouter.prototype.openFilterModal=function(e){var t=this.modals[e.toLowerCase()];if(t){var o,n=e.toLowerCase();try{"plc"==n&&"function"==typeof window.showPLCFilterModal?window.showPLCFilterModal():"inverter"==n&&"function"==typeof window.showInverterFilterModal?window.showInverterFilterModal():"servo"==n&&"function"==typeof window.showServoFilterModal?window.showServoFilterModal():"hmi"==n&&"function"==typeof window.initHMIFilterModal?window.initHMIFilterModal():"io"==n&&"function"==typeof window.showIOFilterModal&&window.showIOFilterModal()}catch(e){}t.classList.add("show"),this._originalBodyOverflow=document.body.style.overflow,document.body.style.overflow="hidden";try{"function"==typeof CustomEvent?o=new CustomEvent("modalOpen",{detail:{productType:e,modalType:"filter"}}):(o=document.createEvent("CustomEvent")).initCustomEvent("modalOpen",!0,!0,{productType:e,modalType:"filter"}),document.dispatchEvent(o)}catch(e){}}},PageRouter.prototype.closeFilterModal=function(e){e=this.modals[e.toLowerCase()];e&&(e.classList.remove("show"),document.body.style.overflow=this._originalBodyOverflow||"auto")},PageRouter.prototype.confirmFilter=function(e){var t={};try{switch(e.toLowerCase()){case"hmi":t=window.getHmiFilterSelections?window.getHmiFilterSelections():{};break;case"plc":t=window.getPlcFilterSelections?window.getPlcFilterSelections():{};break;case"servo":t=window.getServoFilterSelections?window.getServoFilterSelections():{};break;case"inverter":t=window.getInverterFilterSelections?window.getInverterFilterSelections():{};break;case"io":t=window.getIoFilterSelections?window.getIoFilterSelections():{}}}catch(e){t={}}this.closeFilterModal(e);var o=this;setTimeout(function(){o.showResultPage(e,t)},100)},PageRouter.prototype.showResultPage=function(e,t){var o,n={hmi:"hmiResult",plc:"plcResult",servo:"servoResult",inverter:"inverterResult",io:"ioResult"}[e.toLowerCase()];if(n){this.showPage(n);try{"function"==typeof CustomEvent?o=new CustomEvent("showFilterResults",{detail:{productType:e,filterData:t}}):(o=document.createEvent("CustomEvent")).initCustomEvent("showFilterResults",!0,!0,{productType:e,filterData:t}),document.dispatchEvent(o)}catch(e){}}},PageRouter.prototype.backToMain=function(){this.showPage("main")},PageRouter.prototype.getCurrentPage=function(){return this.currentPage},PageRouter.prototype.hasOpenModal=function(){for(var e=Object.values(this.modals),t=0;t<e.length;t++)if(e[t]&&e[t].classList.contains("show"))return!0;return!1},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){window.pageRouter=new PageRouter}):window.pageRouter=new PageRouter;