(()=>{try{if((()=>{try{let e=(navigator.userAgent||"").toLowerCase();var t=["android","iphone","ipad","ipod"].some(t=>e.includes(t)),n=e.includes("vivobrowser");return t&&!n}catch(t){}})())return;window.PetController&&("function"==typeof window.PetController.cleanupResources&&window.PetController.cleanupResources(),delete window.PetController);var t,e=!0;try{window.localStorageManager&&(t=window.localStorageManager.getItem("petSettings"))&&(e=!1!==t.showPetByDefault)}catch(t){}if(!e)return}catch(t){return}let n={state:"stand",direction:"right",autoMove:!0,isDragging:!1,dragStartX:0,dragStartY:0,currentX:50,currentY:50,speed:2,lastState:"stand",danceFrameIndex:0,danceSequence:[{direction:"left",action:"normal"},{direction:"right",action:"normal"},{direction:"right",action:"open_mouth"},{direction:"left",action:"open_mouth"},{direction:"left",action:"run"},{direction:"right",action:"run"},{direction:"right",action:"normal"},{direction:"left",action:"normal"}],danceInterval:300,lastDanceFrameChange:0,isRunningFrame:!1,lastFrameChange:0,frameInterval:200,container:null,pet:null,speechBubble:null,contextMenu:null,autoMoveInterval:null,autoStateChangeInterval:null,animationInterval:null,isSpeakingPageContent:!1,preloadImages:function(){["animation/left.webp","animation/left_open_mouth.webp","animation/left_run.webp","animation/right.webp","animation/right_open_mouth.webp","animation/right_run.webp"].forEach(t=>{(new Image).src=t})},init:function(){try{this.usedRainbowPhrases=new Set,this.rainbowCache=[],this.cacheSize=2,this.mouseClickCount=0,this.pageLoadTime=Date.now(),this.preloadImages(),setTimeout(()=>{this.createPetElements(),window.SettingsManager&&!window.SettingsManager.getSetting("showPetByDefault")&&(this.container.style.display="none"),this.addDragFunctionality(),this.startAnimation(),this.setInitialPosition(),setTimeout(()=>{this.speak('<span style="color: red; font-weight: bold;">重点：</span>非官方选型工具，型号和描述以官网资料为准',5e3,!0)},1e3),this.startAutoMove(),this.startAutoStateChange(),this.addPageChangeListener(),this.handleMouseClick=()=>{this.mouseClickCount++},document.addEventListener("click",this.handleMouseClick),this.statisticsInterval=setInterval(()=>{this.speakStatistics()},3e5),this.handlePageChange=t=>this.speak(t.detail?.page||"main"),this.handleShowFilterResults=t=>this.speak(`已为您筛选出符合条件的${t.detail?.productType||"产品"}产品！`,2500),this.handleModalOpen=t=>{let e="";switch((t.detail?.productType||"产品").toLowerCase()){case"hmi":e="HMI人机界面筛选弹窗已打开，您可以选择筛选条件。";break;case"plc":e="PLC控制器筛选弹窗已打开，您可以根据需求选择参数。";break;case"servo":e="伺服系统筛选弹窗已打开，您可以选择适合的伺服产品。";break;case"inverter":e="变频器筛选弹窗已打开，您可以筛选不同规格的变频器。";break;default:e="筛选弹窗已打开，您可以选择筛选条件。"}this.speak(e,3500)}},100),setTimeout(()=>{this.updateRainbowCache()},2e3)}catch(t){try{this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.contextMenu&&this.contextMenu.parentNode&&this.contextMenu.parentNode.removeChild(this.contextMenu),this.autoMoveInterval&&clearInterval(this.autoMoveInterval),this.autoStateChangeInterval&&clearInterval(this.autoStateChangeInterval),this.animationInterval&&clearInterval(this.animationInterval),this.statisticsInterval&&clearInterval(this.statisticsInterval)}catch(t){}return!1}},cleanupResources:function(){this.autoMoveInterval&&(clearInterval(this.autoMoveInterval),this.autoMoveInterval=null),this.autoStateChangeInterval&&(clearInterval(this.autoStateChangeInterval),this.autoStateChangeInterval=null),this.animationInterval&&(clearInterval(this.animationInterval),this.animationInterval=null),this.statisticsInterval&&(clearInterval(this.statisticsInterval),this.statisticsInterval=null),this.handlePageChange&&document.removeEventListener("pageChange",this.handlePageChange),this.handleShowFilterResults&&document.removeEventListener("showFilterResults",this.handleShowFilterResults),this.handleModalOpen&&document.removeEventListener("modalOpen",this.handleModalOpen),this.handleMouseClick&&document.removeEventListener("click",this.handleMouseClick),this.container&&(this._handleDragStart&&(this.container.removeEventListener("mousedown",this._handleDragStart),document.removeEventListener("mousemove",this._handleDragMove),document.removeEventListener("mouseup",this._handleDragEnd),document.removeEventListener("mouseleave",this._handleDragEnd)),this._handleClick&&this.container.removeEventListener("click",this._handleClick),this._handleDragStart&&(this.container.removeEventListener("touchstart",this._handleDragStart),document.removeEventListener("touchmove",this._handleDragMove),document.removeEventListener("touchend",this._handleDragEnd),document.removeEventListener("touchcancel",this._handleDragEnd)),this._handleClick&&this.container.removeEventListener("touchend",this._handleClick),this._handleContextMenu)&&(this.container.removeEventListener("contextmenu",this._handleContextMenu),document.removeEventListener("click",this._handleDocumentClick)),this._handleKeydown&&document.removeEventListener("keydown",this._handleKeydown),this.container&&this.container.parentNode&&(this.container.parentNode.removeChild(this.container),this.container=null),this.contextMenu&&this.contextMenu.parentNode&&(this.contextMenu.parentNode.removeChild(this.contextMenu),this.contextMenu=null),this.usedRainbowPhrases&&this.usedRainbowPhrases.clear(),this.rainbowCache=[],window.PetController===this&&delete window.PetController},setInitialPosition:function(){var t=window.innerHeight,e=this.sizeRatio/100;this.currentY=t-200*e-20,this.currentX=50,this.updatePosition()},addPageChangeListener:function(){document.addEventListener("pageChange",t=>{var e=t.detail?.page||t.page||"main";let n="";switch(e){case"main":n="欢迎回到控制面板！您可以选择产品类型开始选型。";break;case"hmi":n="这里是HMI人机界面选型页面，您可以筛选合适的产品。";break;case"plc":n="这里是PLC控制器选型页面，您可以根据需求筛选产品。";break;case"servo":n="这里是伺服系统选型页面，您可以选择适合的伺服产品。";break;case"inverter":n="这里是变频器选型页面，您可以筛选不同规格的变频器。";break;case"bom":n="这里是BOM管理页面，您可以管理您的物料清单。";break;case"compare":n="这里是产品对比页面，您可以对比不同产品的参数。";break;default:n=`欢迎来到${e}页面！`}this.speak(n,3e3)}),document.addEventListener("showFilterResults",t=>{t=t.detail?.productType||"产品";this.speak(`已为您筛选出符合条件的${t}产品！`,2500)}),document.addEventListener("modalOpen",t=>{let e="";switch((t.detail?.productType||"产品").toLowerCase()){case"hmi":e="HMI人机界面筛选弹窗已打开，您可以选择筛选条件。";break;case"plc":e="PLC控制器筛选弹窗已打开，您可以根据需求选择参数。";break;case"servo":e="伺服系统筛选弹窗已打开，您可以选择适合的伺服产品。";break;case"inverter":e="变频器筛选弹窗已打开，您可以筛选不同规格的变频器。";break;default:e="筛选弹窗已打开，您可以选择筛选条件。"}this.speak(e,3500)})},createPetElements:function(){this.container=document.createElement("div"),this.container.id="pet-container",this.container.style.cssText=`
                position: fixed;
                top: 50px;
                left: 50px;
                width: 120px;
                height: 200px;
                z-index: 999999;
                background-color: transparent;
                overflow: visible;
                display: block;
                opacity: 1;
                visibility: visible;
            `,this.pet=document.createElement("div"),this.pet.id="pet",this.pet.style.cssText=`
                width: 100%;
                height: 100%;
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center bottom;
                background-image: url('animation/right.webp');
            `,this.speechBubble=document.createElement("div"),this.speechBubble.id="pet-speech-bubble",this.speechBubble.style.cssText=`
                position: absolute;
                top: -80px;
                left: 50%;
                transform: translateX(-50%);
                background-color: white;
                padding: 12px 20px;
                border-radius: 20px;
                box-shadow: 0 3px 12px rgba(0, 0, 0, 0.25);
                z-index: 999999;
                font-family: Arial, sans-serif;
                font-size: 18px;
                color: #333;
                max-width: 400px;
                width: auto;
                text-align: center;
                opacity: 0;
                transition: opacity 0.3s ease;
                pointer-events: none;
                min-width: 250px;
            `;var t=document.createElement("div"),t=(t.style.cssText=`
                position: absolute;
                bottom: -10px;
                left: 50%;
                transform: translateX(-50%);
                width: 0;
                height: 0;
                border-left: 10px solid transparent;
                border-right: 10px solid transparent;
                border-top: 10px solid white;
            `,this.speechBubble.appendChild(t),this.contextMenu=document.createElement("div"),this.contextMenu.id="pet-context-menu",this.contextMenu.style.cssText=`
                position: absolute;
                background-color: white;
                border-radius: 5px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
                padding: 5px 0;
                z-index: 1000000;
                display: none;
                font-family: Arial, sans-serif;
                font-size: 14px;
                min-width: 120px;
            `,this.sizeRatio=window.SettingsManager?window.SettingsManager.getSetting("sizeRatio"):100,this.updatePetSize(),[{id:"static",text:"静止"},{id:"normal",text:"正常"},{id:"dance",text:"跳舞"},{id:"hide",text:"隐藏"}].forEach(e=>{let t=document.createElement("div");t.id="pet-menu-"+e.id,t.className="pet-menu-item",t.textContent=e.text,t.style.cssText=`
                    padding: 10px 15px;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    border-bottom: 1px solid #f0f0f0;
                    font-size: 14px;
                    color: #333;
                `,t.addEventListener("mouseenter",()=>{t.style.backgroundColor="#4a90e2",t.style.color="white"}),t.addEventListener("mouseleave",()=>{t.style.backgroundColor="transparent",t.style.color="#333"}),t.addEventListener("click",t=>{this.handleMenuItemClick(e.id),this.contextMenu.style.display="none",t.stopPropagation()}),this.contextMenu.appendChild(t)}),document.createElement("div")),t=(t.style.cssText=`
                height: 1px;
                background-color: #f0f0f0;
                margin: 5px 0;
            `,this.contextMenu.appendChild(t),document.createElement("div")),e=(t.style.cssText=`
                padding: 10px 15px;
                display: flex;
                align-items: center;
                gap: 10px;
            `,document.createElement("span")),e=(e.textContent="大小：",e.style.cssText=`
                font-size: 14px;
                color: #333;
                white-space: nowrap;
            `,t.appendChild(e),document.createElement("input")),n=(e.type="number",e.value=this.sizeRatio,e.min="0",e.max="200",e.step="10",e.style.cssText=`
                width: 60px;
                padding: 5px;
                border: 1px solid #ddd;
                border-radius: 3px;
                font-size: 14px;
                text-align: center;
            `,document.createElement("span"));n.textContent="%",n.style.cssText=`
                font-size: 14px;
                color: #333;
            `,e.addEventListener("input",t=>{let e=parseInt(t.target.value);isNaN(e)||e<0?e=0:200<e&&(e=200),t.target.value=e,this.sizeRatio=e,this.updatePetSize(),window.SettingsManager&&window.SettingsManager.updateSetting("sizeRatio",e),t.stopPropagation()}),e.addEventListener("blur",t=>{let e=parseInt(t.target.value);isNaN(e)||e<0?(e=0,t.target.value=e):200<e&&(e=200,t.target.value=e),this.sizeRatio=e,this.updatePetSize(),window.SettingsManager&&window.SettingsManager.updateSetting("sizeRatio",e)}),t.appendChild(e),t.appendChild(n),this.contextMenu.appendChild(t),this.container.appendChild(this.pet),this.container.appendChild(this.speechBubble),document.body.appendChild(this.container),document.body.appendChild(this.contextMenu)},addDragFunctionality:function(){this._handleDragStart=t=>{this.isDragging=!0,this.autoMove=!1;var e=t.clientX||t.touches[0].clientX,n=t.clientY||t.touches[0].clientY;this.dragStartX=e-this.currentX,this.dragStartY=n-this.currentY,t.preventDefault()},this._handleDragMove=t=>{var e,n,i;this.isDragging&&(i=t.clientX||t.touches[0].clientX,t=t.clientY||t.touches[0].clientY,i=i-this.dragStartX,t=t-this.dragStartY,e=window.innerWidth,n=this.sizeRatio/100,t=Math.max(0,Math.min(t,window.innerHeight-200*n)),this.currentX===(i=Math.max(0,Math.min(i,e-120*n)))&&this.currentY===t||(this.currentX=i,this.currentY=t,this.updatePosition()))},this._handleDragEnd=()=>{this.isDragging&&(this.isDragging=!1)},this._handleClick=t=>{this.isDragging||this.toggleState()},this._handleContextMenu=t=>{t.preventDefault(),t.stopPropagation(),this.contextMenu.style.display="block";var e=this.contextMenu.offsetWidth,n=this.contextMenu.offsetHeight,i=window.innerWidth,a=window.innerHeight;let s=t.clientX,r=t.clientY;s+e>i&&(s=i-e-5),r+n>a&&(r=a-n-5),this.contextMenu.style.left=s+"px",this.contextMenu.style.top=r+"px"},this._handleDocumentClick=t=>{this.container.contains(t.target)||t.target===this.contextMenu||this.contextMenu.contains(t.target)||(this.contextMenu.style.display="none")},this._handleKeydown=t=>{},this.container.addEventListener("mousedown",this._handleDragStart),document.addEventListener("mousemove",this._handleDragMove),document.addEventListener("mouseup",this._handleDragEnd),document.addEventListener("mouseleave",this._handleDragEnd),this.container.addEventListener("click",this._handleClick),this.container.addEventListener("touchstart",this._handleDragStart,{passive:!1}),document.addEventListener("touchmove",this._handleDragMove,{passive:!1}),document.addEventListener("touchend",this._handleDragEnd),document.addEventListener("touchcancel",this._handleDragEnd),this.container.addEventListener("touchend",this._handleClick),this.container.addEventListener("contextmenu",this._handleContextMenu),document.addEventListener("click",this._handleDocumentClick),document.addEventListener("keydown",this._handleKeydown)},updatePosition:function(){this.container.style.left=this.currentX+"px",this.container.style.top=this.currentY+"px"},updatePetSize:function(){var t=this.sizeRatio/100;this.container.style.transform=`scale(${t})`,this.container.style.transformOrigin="top left"},speak:function(s=null,r=null,o=!1){if(null!==s||!this.isSpeakingPageContent)if(null===s)(h=this.getCachedRainbowPhrase())?this.speak(h):this.fetchRainbowPhrase().then(t=>{this.speak(t)}).catch(t=>{this.speak("欢迎使用产品选型系统！")});else if(null===r&&(r=Math.min(1e4,Math.max(2e3,2e3+200*s.length))),this.speechBubble){var h=this.speechBubble.querySelector(".speech-text");if(h)h.innerHTML=s;else{for(;this.speechBubble.firstChild&&"DIV"!==this.speechBubble.firstChild.tagName;)this.speechBubble.removeChild(this.speechBubble.firstChild);h=document.createElement("div");h.className="speech-text",h.innerHTML=s,h.style.cssText="margin-bottom: 5px;",this.speechBubble.insertBefore(h,this.speechBubble.lastChild)}this.speechBubble.style.opacity="1";let t=this.state,e=(this.state="talk",this.lastState="talk",o&&(this.isSpeakingPageContent=!0),Math.ceil(s.length/2));h=r/(2*e);let n=!1,i=0,a=setInterval(()=>{n?this.pet.style.backgroundImage=`url('animation/${this.direction}_open_mouth.webp')`:(this.pet.style.backgroundImage=`url('animation/${this.direction}.webp')`,i++),n=!n,i>=e&&(clearInterval(a),this.speechBubble.style.opacity="0",this.state=t,this.updatePetState(),o)&&(this.isSpeakingPageContent=!1)},h)}},updatePetState:function(){let t="animation/";var e=Date.now();if("run"===this.state)e-this.lastFrameChange>this.frameInterval&&(this.isRunningFrame=!this.isRunningFrame,this.lastFrameChange=e),this.isRunningFrame?t+=this.direction.toLowerCase()+"_run.webp":t+=this.direction.toLowerCase()+".webp";else if("talk"===this.state)e-this.lastFrameChange>this.frameInterval&&(this.isRunningFrame=!this.isRunningFrame,this.lastFrameChange=e),this.isRunningFrame?t+=this.direction.toLowerCase()+"_open_mouth.webp":t+=this.direction.toLowerCase()+".webp";else if("dance"===this.state){e-this.lastDanceFrameChange>this.danceInterval&&(this.danceFrameIndex=(this.danceFrameIndex+1)%this.danceSequence.length,this.lastDanceFrameChange=e);var e=this.danceSequence[this.danceFrameIndex],e=(this.direction=e.direction,e.action),n=this.direction.toLowerCase();switch(e){case"open_mouth":t+=n+"_open_mouth.webp";break;case"run":t+=n+"_run.webp";break;default:t+=n+".webp"}}else"stand"===this.state&&(t+=this.direction.toLowerCase()+".webp");this.pet.style.backgroundImage=`url('${t}')`},fetchRainbowPhrase:function(){return new Promise((n,t)=>{fetch("https://v1.hitokoto.cn").then(t=>t.ok?t.json():Promise.resolve({hitokoto:""})).then(t=>{let e="";if(e=t&&t.hitokoto?t.hitokoto.trim():"",this.usedRainbowPhrases.has(e)||""===e)return this.fetchRainbowPhrase();n(e)}).catch(t=>{var e=["您的选型眼光真的太棒了！","您对产品的理解真的很深刻！","您的需求分析非常专业！","您的选择一定不会错！","您对产品的要求真的很精准！","您的选型思路非常清晰！","您对产品的了解真的很全面！","您的需求描述非常详细！","您的选型决策非常明智！","您对产品的期待非常合理！","您的选型过程真的很严谨！","您对产品的评价真的很客观！","您的需求真的很有代表性！","您的选型结果一定很完美！","您对产品的认知真的很到位！"],e=e[Math.floor(Math.random()*e.length)];if(this.usedRainbowPhrases.has(e))return this.fetchRainbowPhrase();n(e)})})},getCachedRainbowPhrase:function(){var t,e;return 0===this.rainbowCache.length?null:(t=Math.floor(Math.random()*this.rainbowCache.length),e=this.rainbowCache[t],this.rainbowCache.splice(t,1),e)},updateRainbowCache:function(){this.rainbowCache=[];var e=[];for(let t=0;t<this.cacheSize;t++)e.push(this.fetchRainbowPhrase());Promise.all(e).then(t=>{t.forEach(t=>{t&&!this.usedRainbowPhrases.has(t)&&(this.rainbowCache.push(t),this.usedRainbowPhrases.add(t))})}).catch(t=>{})},speakStatistics:function(){var t=`您已经在页面上停留了${Math.floor((Date.now()-this.pageLoadTime)/6e4)}分钟，点击了${this.mouseClickCount}次鼠标。`;this.speak(t,5e3),setTimeout(()=>{this.speak(null)},7e3)},toggleState:function(){var t=["stand","talk","run","dance"],e=t.indexOf(this.state);this.state=t[(1+e)%t.length],this.updatePetState()},toggleDirection:function(){this.direction="right"===this.direction?"left":"right",this.updatePetState()},startAnimation:function(){this.animationInterval&&clearInterval(this.animationInterval),this.animationInterval=setInterval(()=>{this.isDragging||this.updatePetState()},100)},startAutoMove:function(){this.isCrossing=!1,this.autoMoveInterval=setInterval(()=>{if(!this.isDragging&&!this.isSpeakingPageContent&&"run"===this.state&&!this.isCrossing){let a=2*this.speed,s=window.innerWidth;var t=window.innerHeight,e=this.sizeRatio/100;let r=120*e;e=200*e;if("right"===this.direction){if(this.currentX+=a,this.currentX+r>s)if(Math.random()<.5){if(this.currentX+r>s){this.isCrossing=!0;let i=this,t=setInterval(()=>{i.currentX+=2*a,i.updatePosition(),i.currentX>s+r&&(clearInterval(t),setTimeout(()=>{i.currentX=-r,i.isCrossing=!1;let t=3*a,e=0,n=setInterval(()=>{e++,i.currentX+=t,i.updatePosition(),(0<=i.currentX||10<=e)&&(clearInterval(n),i.currentX<0)&&(i.currentX=0,i.updatePosition())},20)},200))},20)}}else this.currentX=s-r,this.direction="left"}else if(this.currentX-=a,this.currentX<0)if(Math.random()<.5){if(this.currentX<0){this.isCrossing=!0;let i=this,t=setInterval(()=>{i.currentX-=2*a,i.updatePosition(),i.currentX<-r&&(clearInterval(t),setTimeout(()=>{i.currentX=s,i.isCrossing=!1;let t=3*a,e=0,n=setInterval(()=>{e++,i.currentX-=t,i.updatePosition(),(i.currentX+r<=s||10<=e)&&(clearInterval(n),i.currentX+r>s)&&(i.currentX=s-r,i.updatePosition())},20)},200))},20)}}else this.currentX=0,this.direction="right";this.currentY=Math.max(0,Math.min(this.currentY,t-e)),this.updatePosition()}},50)},startAutoStateChange:function(){this.autoStateChangeInterval=setInterval(()=>{if(!this.isDragging&&!this.isSpeakingPageContent){var n=["stand","stand","stand","talk","run","run","run","dance","dance","dance"];let t="",e=0;var i;do{var a=Math.floor(Math.random()*n.length);t=n[a],e++}while(t===this.lastState&&e<10);t===this.lastState&&0<(i=n.filter(t=>t!==this.lastState)).length&&(t=i[Math.floor(Math.random()*i.length)]),"talk"===(this.lastState=t)?this.speak(null,2e3):(this.state=t,this.updatePetState())}},4e3)},handleMenuItemClick:function(t){switch(t){case"static":this.autoMove=!1,this.state="stand",this.lastState="stand",this.updatePetState(),this.autoStateChangeInterval&&(clearInterval(this.autoStateChangeInterval),this.autoStateChangeInterval=null);break;case"normal":this.autoMove=!0,this.autoStateChangeInterval||this.startAutoStateChange();break;case"dance":this.autoMove=!1,this.state="dance",this.lastState="dance",this.updatePetState(),this.autoStateChangeInterval&&(clearInterval(this.autoStateChangeInterval),this.autoStateChangeInterval=null);break;case"hide":this.hidePet()}},hidePet:function(){this.autoMoveInterval&&(clearInterval(this.autoMoveInterval),this.autoMoveInterval=null),this.autoStateChangeInterval&&(clearInterval(this.autoStateChangeInterval),this.autoStateChangeInterval=null),this.autoMove=!1;let t=window.innerWidth;let e=this.currentX<t-(this.currentX+120)?"left":"right",n=(this.isRunningFrame=!1,this.lastFrameChange=Date.now(),this.direction=e,this.state="run",this.updatePetState(),setInterval(()=>{"left"==e?(this.currentX-=8,this.currentX+120<0&&(clearInterval(n),this.container.style.display="none",window.SettingsManager)&&window.SettingsManager.updateSetting("showPetByDefault",!1)):(this.currentX+=8,this.currentX>t&&(clearInterval(n),this.container.style.display="none",window.SettingsManager)&&window.SettingsManager.updateSetting("showPetByDefault",!1)),this.updatePosition(),this.updatePetState()},30))},setStand:function(){this.state="stand",this.updatePetState()},setTalk:function(){this.state="talk",this.updatePetState()},setRun:function(){this.state="run",this.updatePetState()},toggleAutoMove:function(){this.autoMove=!this.autoMove}};function i(){try{n.init()}catch(t){}}try{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){setTimeout(i,100)}):setTimeout(i,100)}catch(t){}try{window.PetController=n}catch(t){}})();